From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Andreas Dinter <andreas.dinter@systec-electronic.com>
Date: Fri, 20 Jun 2025 15:07:39 +0200
Subject: [PATCH] ti/am62x: Enable first internal watchdog and pass 30s timeout
 to kernel

Signed-off-by: Andreas Dinter <andreas.dinter@systec-electronic.com>
---
 board/ti/am62x/sysworxx.env               |  2 +-
 configs/am625_sysworxx_a53.config         |  5 +++++
 dts/upstream/src/arm64/ti/k3-am625-sk.dts | 25 +++++++++++++++++++++++
 3 files changed, 31 insertions(+), 1 deletion(-)

diff --git a/board/ti/am62x/sysworxx.env b/board/ti/am62x/sysworxx.env
index abd653e48d3..1bac62e2904 100644
--- a/board/ti/am62x/sysworxx.env
+++ b/board/ti/am62x/sysworxx.env
@@ -17,7 +17,7 @@ findfdt=
 
 name_kern=Image
 console=ttyS2,115200n8
-args_all=setenv optargs ${optargs} earlycon=ns16550a,mmio32,0x02800000 quiet
+args_all=setenv optargs ${optargs} earlycon=ns16550a,mmio32,0x02800000 quiet rti_wdt.heartbeat=30
 args_mmc=
 	setenv bootargs console=${console} ${optargs} root=${root_mmc} rw rootfstype=${mmcrootfstype}
 
diff --git a/configs/am625_sysworxx_a53.config b/configs/am625_sysworxx_a53.config
index 2d3190a8e07..c0dcf1ead99 100644
--- a/configs/am625_sysworxx_a53.config
+++ b/configs/am625_sysworxx_a53.config
@@ -4,3 +4,8 @@ CONFIG_TARGET_SYSWORXX_AM62X_ADOPT=y
 CONFIG_ENV_SOURCE_FILE="sysworxx"
 CONFIG_BOOTCOMMAND="run bootcmd_sysworxx;"
 CONFIG_RESET_PHY_R=y
+CONFIG_WDT=yes
+CONFIG_CMD_WDT=y
+CONFIG_WDT_K3_RTI=y
+CONFIG_WATCHDOG=y
+CONFIG_WATCHDOG_AUTOSTART=n
diff --git a/dts/upstream/src/arm64/ti/k3-am625-sk.dts b/dts/upstream/src/arm64/ti/k3-am625-sk.dts
index fd797eb5186..24165e2b823 100644
--- a/dts/upstream/src/arm64/ti/k3-am625-sk.dts
+++ b/dts/upstream/src/arm64/ti/k3-am625-sk.dts
@@ -257,3 +257,28 @@
 		>;
 	status = "okay";
 };
+
+&main_rti0 {
+	status = "okay";
+	timeout-sec = <30>;
+	u-boot,autostart;
+};
+
+// All other watchdogs need to be disabled since we do not always have them for
+// some sysWORXX devices (e.g. CTR-800 with AM623)
+
+&main_rti1 {
+	status = "disabled";
+};
+
+&main_rti2 {
+	status = "disabled";
+};
+
+&main_rti3 {
+	status = "disabled";
+};
+
+&main_rti15 {
+	status = "disabled";
+};
-- 
2.50.1

